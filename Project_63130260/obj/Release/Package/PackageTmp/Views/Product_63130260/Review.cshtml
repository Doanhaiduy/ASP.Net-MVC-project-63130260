@model DATA_63130260.Entity.product_item
@{
    ViewBag.Title = "Review " + Model.product.name;
    Layout = "~/Views/Shared/_LayoutSinp.cshtml";
    var mapReview = new DATA_63130260.mapReview();
    var valueRating = mapReview.GetAvgRatingProduct(Model.id);
    var listReview = mapReview.GetAllReviews(Model.id);
}


<div class="py-9 bg-gray-100">
    <div class="flex justify-center items-center">
        <div class="">
            <nav>
                <ul class="flex flex-wrap items-center justify-center">
                    <li class="mr-5">
                        <a href="/"
                           class="text-black font-medium text-base uppercase transition-all hover:text-orange-500">Product</a>
                    </li>
                    /
                    <li class="text-black font-medium text-base uppercase ml-5">
                        Reviews
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>
<section class=" px-[30px] 2xl:px-[150px] py-[60px] gap-8">
    <div class="px-4 py-4 mx-auto lg:py-8 md:px-6">
        <div class="flex -mx-4 md:flex-row-reverse items-center justify-center flex-col-reverse gap-5">
            <form class="px-4" method="post" id="send_review">
                <div class="flex flex-col max-w-xl p-8 shadow-sm rounded-md lg:p-12 mx-auto border bg-white border-orange-500">
                    <div class="flex flex-col items-center w-full">
                        <h2 class="text-3xl font-semibold text-center">
                            Your opinion matters!
                        </h2>
                        <div class="flex flex-col items-center py-6 space-y-3">
                            <span class="text-center">How was your experience?</span>
                            <div class="flex space-x-3">
                                <p title="Rate 1 stars" data-star="1"
                                   aria-label="Rate 1 stars" class=" cursor-pointer star">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         viewBox="0 0 20 20" fill="currentColor"
                                         class="w-10 h-10 ">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                </p>
                                <p title="Rate 2 stars" class="cursor-pointer star" data-star="2"
                                   aria-label="Rate 2 stars">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         viewBox="0 0 20 20" fill="currentColor"
                                         class="w-10 h-10 ">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                </p>
                                <p title="Rate 3 stars" class="cursor-pointer star" data-star="3"
                                   aria-label="Rate 3 stars">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         viewBox="0 0 20 20" fill="currentColor"
                                         class="w-10 h-10 ">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                </p>
                                <p title="Rate 4 stars" class="cursor-pointer star" data-star="4"
                                   aria-label="Rate 4 stars">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         viewBox="0 0 20 20" fill="currentColor"
                                         class="w-10 h-10 ">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                </p>
                                <p title="Rate 5 stars" class="cursor-pointer star" data-star="5"
                                   aria-label="Rate 5 stars">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         viewBox="0 0 20 20" fill="currentColor"
                                         class="w-10 h-10 ">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                </p>
                                <input type="hidden" name="rating_value" value="0" />
                                <input type="hidden" name="ordered_product_id" value="@ViewBag.ordered_product_id" />
                            </div>
                            <span class="text-red-500 text-[12px] hidden" id="rating_error">Please select rating</span>
                        </div>
                        <div class="flex flex-col w-full">
                            <textarea rows="3" placeholder="Message..." name="comment"
                                      class="p-4 rounded-md resize-none border border-orange-500 outline-none"></textarea>
                            <span class="text-red-500 text-[12px] hidden" id="comment_error">Please enter a review</span>
                            <button type="submit"
                                    class="py-4 my-8 font-semibold rounded-md bg-orange-500 text-white">
                                Submit review
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center justify-center">
                        <a rel="noopener noreferrer" href="/" class="text-sm">
                            Maybe
                            later
                        </a>
                    </div>
                </div>
            </form>
            <div class="px-4">
                <div class="lg:pl-20">
                    <div class="pb-6 mb-8 border-b border-gray-200 ">
                        <h2 class="max-w-xl mt-2 mb-6 text-xl font-bold  md:text-4xl">
                            @Model.product.name
                        </h2>
                        <div class="flex flex-wrap items-center mb-6">
                            <ul class="flex mb-4 mr-2 lg:mb-0 items-center">
                                @if (valueRating != 0)
                                {
                                    <li class="mr-2  text-orange-500">
                                        @string.Format("{0:0.0}", valueRating) |
                                    </li>
                                    for (int i = 0; i < (int)Math.Ceiling(valueRating); i++)
                                    {
                                        <li>
                                            <a href="#">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     width="16" height="16"
                                                     fill="#f97316"
                                                     class="w-4 mr-1 text-red-500  bi bi-star "
                                                     viewBox="0 0 16 16">
                                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z" />
                                                </svg>
                                            </a>
                                        </li>

                                    }
                                    <li class="ml-2 text-orange-500">
                                        |  <a href="">@listReview.Count Reviews</a>
                                    </li>
                                }
                                else
                                {
                                    <li>
                                        <a class="mb-4 text-xs underline  lg:mb-0" href="#">
                                            Be the first to review the product
                                        </a>
                                    </li>
                                }
                            </ul>
                           
                        </div>
                        <p class="max-w-md mb-8 text-gray-700 ">
                            @Model.product.description
                        </p>

                        <p class="inline-block text-2xl font-semibold text-gray-700  ">
                            @{
                                var price = DATA_63130260.mapPromotion.CheckAndCalculatePrice(Model);
                            }
                            @if (price != Model.price)
                            {

                                <span>@string.Format("{0:#,0đ}", price)</span>
                                <span class="text-base font-normal text-gray-500 line-through ">@string.Format("{0:#,0đ}", Model.price)</span>
                            }
                            else
                            {
                                <span>@string.Format("{0:#,0đ}", Model.price)</span>
                            }
                        </p>
                    </div>

                    <form class="flex flex-wrap items-center "
                          action="/Home_63130260/AddProductToCart"
                          method="post">

                        <div class="flex flex-wrap mt-6">
                            <a href="#" class="mr-2">
                                <img src="/content/assets/images/payment.webp" alt="payment icon">
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>
</section>

@section scripts{
    <script>
        const stars = document.querySelectorAll(".star");
        const ratingInput = document.querySelector('input[name="rating_value"]');
        const comment = document.querySelector('textarea[name="comment"]');
        stars.forEach(item => {
            item.addEventListener("click", function () {
                document.getElementById("rating_error").classList.add("hidden");
                const clickedStar = parseInt(item.dataset.star);
                stars.forEach(star => {
                    const starValue = parseInt(star.dataset.star);
                    if (starValue <= clickedStar) {
                        star.classList.add("text-[#ffa500]");
                    } else {
                        star.classList.remove("text-[#ffa500]");
                    }
                });
                ratingInput.value = clickedStar;
                console.log(ratingInput)
            });
        });
        comment.onchange = function () {
            if (comment.value.trim() !== "") {
                document.getElementById("comment_error").classList.add("hidden");
            }
            else {
                document.getElementById("comment_error").classList.remove("hidden");
            }
        }
        document.getElementById('send_review').addEventListener("submit", function (event) {
            if (ratingInput.value === "0" || comment.value === "") {
                if (ratingInput.value === "0") {
                    document.getElementById("rating_error").classList.remove("hidden");
                }
                event.preventDefault();
            }
        });

    </script>

}